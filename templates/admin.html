{% extends "base.html" %}

{% block content %}
<section>
    <h2>üîß Admin Dashboard</h2>
    <p>Manage all incoming requests below.</p>


    <!-- Search and Filter Form -->
    <div style="background-color: var(--pico-background-color); padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
        <form method="get">
            <div class="grid">
                <div>
                    <label for="q">üîç Search</label>
                    <input type="search" id="q" name="q" value="{{ q }}" placeholder="Search in title, details, or name...">
                </div>
                <div>
                    <label for="status">Status</label>
                    <select id="status" name="status">
                        <option value="">All Statuses</option>
                        <option value="new" {% if status == 'new' %}selected{% endif %}>üÜï New</option>
                        <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>‚öôÔ∏è In Progress</option>
                        <option value="done" {% if status == 'done' %}selected{% endif %}>‚úÖ Done</option>
                    </select>
                </div>
                <div>
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority">
                        <option value="">All Priorities</option>
                        <option value="low" {% if priority == 'low' %}selected{% endif %}>üü¢ Low</option>
                        <option value="normal" {% if priority == 'normal' %}selected{% endif %}>üü° Normal</option>
                        <option value="high" {% if priority == 'high' %}selected{% endif %}>üî¥ High</option>
                    </select>
                </div>
                <div>
                    <label for="category">Category</label>
                    <select id="category" name="category">
                        <option value="">All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}" {% if category == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div style="margin-top: 1rem;">
                <button type="submit">üîç Filter</button>
                <a href="/admin" role="button" class="outline">üóëÔ∏è Clear</a>
                {% if q or status or priority or category %}
                <small style="color: var(--pico-muted-color); margin-left: 1rem;">
                    Showing filtered results
                    {% if q %}for "{{ q }}"{% endif %}
                    {% if status %}‚Ä¢ Status: {{ status }}{% endif %}
                    {% if priority %}‚Ä¢ Priority: {{ priority }}{% endif %}
                    {% if category %}‚Ä¢ Category: {{ category }}{% endif %}
                </small>
                {% endif %}
            </div>
        </form>
    </div>

    {% if items %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>From</th>
                        <th>Category</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td><strong>#{{ item.id }}</strong></td>
                        <td>
                            <strong>{{ item.title }}</strong>
                            {% if item.details|length > 80 %}
                                <br><small style="color: var(--pico-muted-color);">{{ item.details[:80] }}...</small>
                            {% else %}
                                <br><small style="color: var(--pico-muted-color);">{{ item.details }}</small>
                            {% endif %}
                        </td>
                        <td>
                            {{ item.name }}
                            {% if item.contact %}
                                <br><small style="color: var(--pico-muted-color);">{{ item.contact }}</small>
                            {% endif %}
                        </td>
                        <td>{{ item.category or '-' }}</td>
                        <td>
                            <span class="priority-{{ item.priority }}">
                                {% if item.priority == 'high' %}üî¥ Alta
                                {% elif item.priority == 'low' %}üü¢ Baixa
                                {% else %}üü° Normal
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <span class="status-{{ item.status }}">
                                {% if item.status == 'new' %}üÜï New
                                {% elif item.status == 'in_progress' %}‚öôÔ∏è In Progress
                                {% else %}‚úÖ Done
                                {% endif %}
                            </span>
                        </td>
                        <td>{{ item.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <a href="/admin/{{ item.id }}" role="button" class="outline">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No requests found. <a href="/">Submit the first one!</a></p>
    {% endif %}
</section>

<style>
.priority-high { color: #d63384; font-weight: bold; }
.priority-low { color: #198754; font-weight: bold; }
.priority-normal { color: #fd7e14; font-weight: bold; }
.status-new { color: #0d6efd; font-weight: bold; }
.status-in_progress { color: #fd7e14; font-weight: bold; }
.status-done { color: #198754; font-weight: bold; }
</style>
{% endblock %}
